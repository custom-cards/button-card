<!DOCTYPE html>
<html>
<head>
    <title>Button Card Icon Tap Action Test</title>
    <script type="module" src="http://localhost:5000/button-card.js"></script>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            max-width: 400px;
        }
        button-card {
            display: block;
            margin: 10px 0;
            width: 150px;
            height: 100px;
        }
    </style>
</head>
<body>
    <h1>Button Card Icon Tap Action Test</h1>
    
    <div class="test-container">
        <h3>Test 1: Card with icon_tap_action</h3>
        <p>Card should toggle, icon should show alert for more-info action</p>
        <button-card id="test1"></button-card>
    </div>

    <div class="test-container">
        <h3>Test 2: Card without icon_tap_action</h3>
        <p>Both card and icon should perform toggle action</p>
        <button-card id="test2"></button-card>
    </div>

    <script>
        // Mock HASS object
        const mockHass = {
            states: {
                'light.test': {
                    entity_id: 'light.test',
                    state: 'off',
                    attributes: {
                        friendly_name: 'Test Light'
                    }
                }
            },
            localize: (key) => key,
            locale: { language: 'en' },
            config: { time_zone: 'UTC' },
            entities: {},
            user: { id: 'test', name: 'test' }
        };

        // Test 1: With icon_tap_action
        document.getElementById('test1').setConfig({
            type: 'custom:button-card',
            entity: 'light.test',
            name: 'Test Light',
            show_icon: true,
            tap_action: {
                action: 'toggle'
            },
            icon_tap_action: {
                action: 'more-info'
            }
        });
        document.getElementById('test1').hass = mockHass;

        // Test 2: Without icon_tap_action (should default to none)
        document.getElementById('test2').setConfig({
            type: 'custom:button-card', 
            entity: 'light.test',
            name: 'Normal Light',
            show_icon: true,
            tap_action: {
                action: 'toggle'
            }
        });
        document.getElementById('test2').hass = mockHass;

        // Listen for hass-action events to verify actions are working
        document.addEventListener('hass-action', (e) => {
            console.log('Action fired:', e.detail);
            alert(`Action: ${e.detail.action}\nConfig: ${JSON.stringify(e.detail.config, null, 2)}`);
        });
    </script>
</body>
</html>